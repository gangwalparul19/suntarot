<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Sun Tarot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=PT+Sans:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <div class="stars" id="stars"></div>

    <header class="header">
        <nav class="nav container">
            <a href="index.html" class="logo"><img src="images/logo.png" alt="Sun Tarot" class="logo-img"><span>Sun
                    Tarot</span></a>
            <ul class="nav-links" id="navLinks">
                <li><a href="index.html">Home</a></li>
                <li><a href="reading.html">Reading</a></li>
                <li><a href="love-reading.html">Love</a></li>
                <li><a href="learn.html">Learn</a></li>
                <li><a href="quiz.html">Quiz</a></li>
                <li><a href="booking.html">Book</a></li>
            </ul>
            <div class="auth-container" id="authContainer">
                <div id="userInfo"></div>
                <button class="btn btn-outline" id="loginBtn" onclick="signInWithGoogle()"
                    style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                    Sign In
                </button>
                <button class="btn btn-outline" id="logoutBtn" onclick="signOut()"
                    style="display: none; padding: 0.5rem 1rem; font-size: 0.875rem;">
                    Sign Out
                </button>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
        </nav>
    </header>

    <main class="section" style="padding-top: 120px;">
        <div class="container admin-container">
            <div class="section-header"
                style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                <h1 class="section-title text-primary" style="margin: 0;">Admin Dashboard</h1>
                <a href="index.html" class="btn btn-outline" style="padding: 0.5rem 1rem;">üåê View Site</a>
            </div>

            <!-- Access Denied (shown to non-admins) -->
            <div class="access-denied" id="accessDenied" style="display: none;">
                <h2 class="text-primary">Access Denied</h2>
                <p class="text-muted" style="margin: 1rem 0;">You don't have permission to access this page.</p>
                <a href="index.html" class="btn btn-primary">Return to Home</a>
            </div>

            <!-- Admin Content (shown to admins only) -->
            <div id="adminContent" style="display: none;">
                <!-- Navigation Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="showPanel('overview')">üìä Overview</button>
                    <button class="admin-tab" onclick="showPanel('bookings')">üìÖ Bookings</button>
                    <button class="admin-tab" onclick="showPanel('customers')">üë• Customers</button>
                    <button class="admin-tab" onclick="showPanel('availability')">üóìÔ∏è Availability</button>
                    <button class="admin-tab" onclick="showPanel('reviews')">‚≠ê Reviews</button>
                    <button class="admin-tab" onclick="showPanel('pricing')">üí∞ Pricing</button>
                </div>

                <!-- Overview Panel -->
                <div class="admin-panel active" id="overviewPanel">
                    <h2>Overview</h2>
                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-number" id="statBookings">-</div>
                            <div class="stat-label">Total Bookings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statRevenue">-</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statUpcoming">-</div>
                            <div class="stat-label">Upcoming Bookings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statPendingReviews">-</div>
                            <div class="stat-label">Pending Reviews</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="statCustomers">-</div>
                            <div class="stat-label">Unique Customers</div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <h3 class="text-primary mb-md">üìà Analytics</h3>
                    <div class="charts-grid">
                        <div class="chart-card">
                            <h4>Booking Trends (Last 30 Days)</h4>
                            <div class="chart-container">
                                <canvas id="bookingTrendsChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Revenue by Service</h4>
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Popular Time Slots</h4>
                            <div class="chart-container">
                                <canvas id="timeSlotsChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>Bookings by City</h4>
                            <div class="chart-container">
                                <canvas id="cityChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-primary mb-md">Popular Services</h3>
                    <div id="popularServices" style="margin-bottom: 2rem;">Loading...</div>

                    <h3 class="text-primary mb-md">Recent Bookings</h3>
                    <div id="recentBookings">Loading...</div>
                </div>

                <!-- Bookings Panel -->
                <div class="admin-panel" id="bookingsPanel">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1.5rem;">
                        <h2 style="margin: 0;">All Bookings</h2>
                        <button class="btn btn-outline" onclick="exportBookingsCSV()" style="padding: 0.5rem 1rem;">
                            üì• Export CSV
                        </button>
                        <button class="btn btn-primary" onclick="openCreateBookingModal()"
                            style="padding: 0.5rem 1rem;">
                            + New Booking
                        </button>
                    </div>
                    <div id="bookingFilters"
                        style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; background: var(--color-background); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--color-border);">
                        <div style="flex: 1; min-width: 200px;">
                            <label class="text-muted"
                                style="font-size: 0.8rem; display: block; margin-bottom: 0.25rem;">Date Range</label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="date" id="filterStartDate" class="search-input"
                                    style="margin-bottom: 0; padding: 0.25rem;">
                                <input type="date" id="filterEndDate" class="search-input"
                                    style="margin-bottom: 0; padding: 0.25rem;">
                            </div>
                        </div>
                        <div style="min-width: 150px;">
                            <label class="text-muted"
                                style="font-size: 0.8rem; display: block; margin-bottom: 0.25rem;">Payment</label>
                            <select id="filterPayment" class="search-input" style="margin-bottom: 0; padding: 0.25rem;">
                                <option value="all">All</option>
                                <option value="Y">Paid (Y)</option>
                                <option value="N">Pending (N)</option>
                            </select>
                        </div>
                        <div style="min-width: 150px;">
                            <label class="text-muted"
                                style="font-size: 0.8rem; display: block; margin-bottom: 0.25rem;">Status</label>
                            <select id="filterStatus" class="search-input" style="margin-bottom: 0; padding: 0.25rem;">
                                <option value="all">All</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button class="btn btn-outline" onclick="applyBookingFilters()"
                                style="padding: 0.4rem 1rem;">
                                Apply Filters
                            </button>
                            <button class="btn btn-text" onclick="resetBookingFilters()"
                                style="margin-left: 0.5rem; font-size: 0.9rem;">
                                Reset
                            </button>
                        </div>
                    </div>
                    <div id="allBookings">Loading...</div>
                </div>

                <!-- Customers Panel -->
                <div class="admin-panel" id="customersPanel">
                    <h2>Customer Management</h2>
                    <p class="text-muted mb-md">View customer profiles, booking history, and add notes.</p>

                    <input type="text" class="search-input" id="customerSearch"
                        placeholder="üîç Search customers by name or email..." oninput="searchCustomers(this.value)">

                    <div class="customer-grid" id="customerGrid">Loading...</div>
                </div>

                <!-- Availability Panel -->
                <div class="admin-panel" id="availabilityPanel">
                    <h2>Manage Availability</h2>
                    <p class="text-muted mb-md">Click on a date to block/unblock it. Blocked dates won't be available
                        for booking.</p>

                    <!-- Bulk Actions -->
                    <div class="bulk-actions">
                        <h4>üìÖ Bulk Date Blocking</h4>
                        <div class="bulk-form">
                            <div class="bulk-input-group">
                                <label>From Date</label>
                                <input type="date" id="bulkFromDate">
                            </div>
                            <div class="bulk-input-group">
                                <label>To Date</label>
                                <input type="date" id="bulkToDate">
                            </div>
                            <button class="btn btn-primary" onclick="blockDateRange()" style="padding: 0.5rem 1rem;">
                                üö´ Block Range
                            </button>
                            <button class="btn btn-outline" onclick="unblockDateRange()" style="padding: 0.5rem 1rem;">
                                ‚úì Unblock Range
                            </button>
                        </div>

                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--color-border);">
                            <label class="text-muted" style="font-size: 0.875rem;">Block recurring weekdays:</label>
                            <div class="weekday-checkboxes">
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="0"><span>Sun</span></label>
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="1"><span>Mon</span></label>
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="2"><span>Tue</span></label>
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="3"><span>Wed</span></label>
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="4"><span>Thu</span></label>
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="5"><span>Fri</span></label>
                                <label class="weekday-checkbox"><input type="checkbox"
                                        value="6"><span>Sat</span></label>
                                <button class="btn btn-outline" onclick="blockRecurringDays()"
                                    style="padding: 0.25rem 0.75rem; font-size: 0.75rem;">
                                    Apply (Next 90 days)
                                </button>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-outline" onclick="changeMonth(-1)">‚Üê Previous</button>
                        <h3 id="currentMonthLabel" class="text-primary" style="margin: 0; line-height: 2.5;"></h3>
                        <button class="btn btn-outline" onclick="changeMonth(1)">Next ‚Üí</button>
                    </div>

                    <div class="availability-grid" id="availabilityGrid">
                        <div class="calendar-day-header">Sun</div>
                        <div class="calendar-day-header">Mon</div>
                        <div class="calendar-day-header">Tue</div>
                        <div class="calendar-day-header">Wed</div>
                        <div class="calendar-day-header">Thu</div>
                        <div class="calendar-day-header">Fri</div>
                        <div class="calendar-day-header">Sat</div>
                    </div>
                    <div id="calendarDays"></div>
                </div>

                <!-- Reviews Panel -->
                <div class="admin-panel" id="reviewsPanel">
                    <h2>Manage Reviews</h2>

                    <div class="admin-tabs" style="margin-bottom: 1rem;">
                        <button class="admin-tab active" onclick="loadReviewsByStatus('pending')">Pending</button>
                        <button class="admin-tab" onclick="loadReviewsByStatus('approved')">Approved</button>
                        <button class="admin-tab" onclick="loadReviewsByStatus('rejected')">Rejected</button>
                    </div>

                    <div id="reviewsList">Loading...</div>
                </div>

                <!-- Pricing Panel -->
                <div class="admin-panel" id="pricingPanel">
                    <h2>Manage Pricing</h2>
                    <p class="text-muted mb-md">Edit service names, prices, and durations. Changes will reflect
                        immediately on the booking page.</p>

                    <div id="pricingForms">Loading...</div>

                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--color-border);">
                        <button class="btn btn-outline" onclick="resetToDefaults()">Reset All to Defaults</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Customer Detail Modal -->
    <div class="admin-modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-primary" id="customerModalTitle">Customer Details</h3>
                <button class="modal-close" onclick="closeCustomerModal()">√ó</button>
            </div>
            <div id="customerModalContent">Loading...</div>
        </div>
    </div>

    <!-- Create Booking Modal -->
    <div class="admin-modal" id="createBookingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-primary">Manual Booking Entry</h3>
                <button class="modal-close" onclick="closeCreateBookingModal()">√ó</button>
            </div>
            <div id="createBookingContent">
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <!-- Column 1: Service Details -->
                    <div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="text-muted">Select Service</label>
                            <select id="createService" class="search-input">
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="text-muted">Date</label>
                            <input type="date" id="createDate" class="search-input">
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="text-muted">Time</label>
                            <select id="createTime" class="search-input">
                                <option value="">Select a date first...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Column 2: Customer Details -->
                    <div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="text-muted">Customer Name</label>
                            <input type="text" id="createName" class="search-input" placeholder="Enter customer name">
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="text-muted">Customer Email</label>
                            <input type="email" id="createEmail" class="search-input"
                                placeholder="Enter customer email">
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <label class="text-muted">Payment Status</label>
                            <select id="createPaymentStatus" class="search-input">
                                <option value="N">Pending (Not Paid)</option>
                                <option value="Y">Paid</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Full Width: Notes -->
                <div style="margin-bottom: 2rem;">
                    <label class="text-muted">Notes</label>
                    <textarea id="createNotes" class="notes-textarea" placeholder="Optional notes..."></textarea>
                </div>

                <!-- Actions -->
                <div style="display: flex; gap: 1rem;">
                    <button class="btn btn-primary" onclick="submitManualBooking()"
                        style="flex: 1; padding: 1rem; font-size: 1rem;">Create Booking</button>
                    <button class="btn btn-outline" onclick="closeCreateBookingModal()"
                        style="flex: 1; padding: 1rem; font-size: 1rem;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reschedule Modal -->
    <div class="admin-modal" id="rescheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-primary">Reschedule Appointment</h3>
                <button class="modal-close" onclick="closeRescheduleModal()">√ó</button>
            </div>
            <div id="rescheduleModalContent">
                <input type="hidden" id="rescheduleBookingId">
                <div style="margin-bottom: 1rem;">
                    <label class="text-muted" style="display: block; margin-bottom: 0.5rem;">New Date</label>
                    <input type="date" id="rescheduleDate" class="search-input" style="margin-bottom: 0;">
                </div>
                <div style="margin-bottom: 1rem;">
                    <label class="text-muted" style="display: block; margin-bottom: 0.5rem;">New Time</label>
                    <select id="rescheduleTime" class="search-input" style="margin-bottom: 0;">
                        <option value="">Select a time...</option>
                    </select>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-primary" onclick="confirmReschedule()">Save Changes</button>
                    <button class="btn btn-outline" onclick="closeRescheduleModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer footer-single-row">
        <div class="container">
            <div class="footer-bottom">
                <p class="footer-credits">Designed with ‚ù§Ô∏è by Parul Gangwal</p>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <!-- Environment Config (generated by build) -->
    <script src="js/env.js" onerror="console.log('env.js not found - using placeholder config')"></script>

    <!-- App Scripts -->
    <script src="js/firebase-config.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/booking.js"></script>
    <script src="js/reviews.js"></script>
    <script src="js/main.js"></script>

    <script src="js/admin.js"></script>



</body>

</html>