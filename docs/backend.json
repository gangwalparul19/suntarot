{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Sun Tarot application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking for a tarot reading session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who made the booking. (Relationship: User 1:N Booking)"
        },
        "dateTime": {
          "type": "string",
          "description": "Date and time of the booking.",
          "format": "date-time"
        },
        "notes": {
          "type": "string",
          "description": "Any notes or special requests from the user."
        }
      },
      "required": [
        "id",
        "userId",
        "dateTime"
      ]
    },
    "Reading": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Reading",
      "type": "object",
      "description": "Represents a tarot card reading session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the reading."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who performed the reading."
        },
        "question": {
          "type": "string",
          "description": "The question the user asked."
        },
        "cards": {
          "type": "array",
          "description": "Array of selected cards.",
          "items": {
            "type": "string"
          }
        },
        "reading": {
          "type": "string",
          "description": "The personalized interpretation of the card reading, potentially generated by AI."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time of the reading."
        }
      },
      "required": [
        "id",
        "userId",
        "question",
        "cards",
        "reading",
        "date"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Only the user can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information for a specific user. Only the user can read/write their own bookings.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier of the booking."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/readings/{readingId}",
        "definition": {
          "entityName": "Reading",
          "schema": {
            "$ref": "#/backend/entities/Reading"
          },
          "description": "Stores reading information for a specific user. Only the user can read their own readings.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "readingId",
              "description": "The unique identifier of the reading."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely manage user data, bookings, and reading information for the Sun Tarot application, prioritizing authorization independence and clear access patterns. It leverages path-based ownership and denormalization to eliminate the need for `get()` calls in security rules, ensuring atomic operations and simplifying debugging.\n\n*   **Users:** User profiles are stored in `/users/{userId}`. This adheres to the Private Data access model. Each user can only access their own profile.  This structure supports the requirement of users being able to see their past bookings and readings.\n*   **Bookings:** Bookings are stored in `/users/{userId}/bookings/{bookingId}`. This follows the User 1:N Entity pattern, ensuring that each booking is directly associated with a user and owned by them. This structure supports listing all bookings associated with a user and makes it easy to secure using path-based rules.\n*   **Readings:** Readings are stored under `/users/{userId}/readings/{readingId}`. This maintains the hierarchical relationship, associating each reading with a specific user. This structure supports listing all readings associated with a user and makes it easy to secure using path-based rules."
  }
}